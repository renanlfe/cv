---
import Section from "./Section.astro";
import type { ExperienceProps } from "@types";

interface Props {
  experience: ExperienceProps[];
}

const { experience } = Astro.props;
---

<Section text="ExperiÃªncia Profissional" href="experience">
  <div class="flex flex-col gap-8 md:flex-row md:gap-12">
    <!-- Company Tabs (Left Side) -->
    <div
      class="flex flex-row overflow-x-auto md:flex-col md:overflow-x-visible"
    >
      <div class="flex flex-row gap-2 md:flex-col md:gap-0" role="tablist">
        {
          experience.map((exp, index) => (
            <button
              class="experience-tab border-l-2 border-[var(--text-muted)] px-4 py-3 text-left text-sm font-medium whitespace-nowrap text-[var(--text-muted)] transition-all hover:bg-primary/10 hover:text-primary md:min-w-[200px]"
              data-index={index}
              role="tab"
              aria-selected={index === 0 ? "true" : "false"}
            >
              {exp.company}
            </button>
          ))
        }
      </div>
    </div>

    <!-- Experience Content (Right Side) -->
    <div class="flex-1">
      {
        experience.map((exp, index) => (
          <div
            class="experience-content"
            data-index={index}
            role="tabpanel"
            style={index === 0 ? "" : "display: none;"}
          >
            <h3 class="mb-1 font-serif text-2xl font-semibold text-[var(--text-main)]">
              {exp.position} <span class="text-primary">@ {exp.company}</span>
            </h3>
            <p class="mb-6 text-sm text-[var(--text-muted)]">
              {exp.startDate} - {exp.endDate}
            </p>

            {Array.isArray(exp.summary) ? (
              <ul class="list-none space-y-3">
                {exp.summary.map((item) => (
                  <li class="relative pl-6 text-base leading-relaxed text-[var(--text-muted)] before:absolute before:top-[6px] before:left-0 before:h-2 before:w-2 before:rounded-full before:bg-primary before:content-['']">
                    {item}
                  </li>
                ))}
              </ul>
            ) : (
              <p class="text-base leading-relaxed text-[var(--text-muted)]">
                {exp.summary}
              </p>
            )}
          </div>
        ))
      }
    </div>
  </div>
</Section>

<script>
  function initExperienceTabs() {
    const tabs = document.querySelectorAll(".experience-tab");
    const contents = document.querySelectorAll(".experience-content");

    // Set initial active state
    if (tabs.length > 0) {
      tabs[0].classList.add("active-tab");
    }

    tabs.forEach((tab) => {
      tab.addEventListener("click", () => {
        const index = tab.getAttribute("data-index");

        // Remove active state from all tabs
        tabs.forEach((t) => {
          t.classList.remove("active-tab");
          t.setAttribute("aria-selected", "false");
        });

        // Hide all content panels
        contents.forEach((content) => {
          (content as HTMLElement).style.display = "none";
        });

        // Activate clicked tab
        tab.classList.add("active-tab");
        tab.setAttribute("aria-selected", "true");

        // Show corresponding content
        const activeContent = document.querySelector(
          `.experience-content[data-index="${index}"]`,
        ) as HTMLElement;
        if (activeContent) {
          activeContent.style.display = "block";
        }
      });
    });
  }

  // Initialize on page load
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", initExperienceTabs);
  } else {
    initExperienceTabs();
  }
</script>

<style>
  .experience-tab.active-tab {
    border-left-color: var(--color-primary);
    color: var(--color-primary);
    background-color: rgba(37, 99, 235, 0.1);
  }

  .experience-tab {
    cursor: pointer;
  }

  /* Scrollbar styling for mobile horizontal scroll */
  .overflow-x-auto::-webkit-scrollbar {
    height: 4px;
  }

  .overflow-x-auto::-webkit-scrollbar-track {
    background: transparent;
  }

  .overflow-x-auto::-webkit-scrollbar-thumb {
    background: var(--text-muted);
    border-radius: 2px;
  }
</style>
